<!---表单验证器加载 参考地址http://coderthemes.com/ubold_1.3/dark_1/form-validation.html-->
<link href="assets/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css" rel="stylesheet" />
<script type="text/javascript" src="assets/plugins/parsleyjs/dist/parsley.min.js"></script>
<script type="text/javascript" src="assets/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
<script src="assets/plugins/bootstrap-filestyle/src/bootstrap-filestyle.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('form').parsley();
        $('input[name="version_time"]').datetimepicker({
            locale: 'zh',format: 'yyyy-mm-dd hh:ii'
        });
        $('input[name="offline_time"]').datetimepicker({
            locale: 'zh',format: 'yyyy-mm-dd hh:ii'
        });
    });
</script>
<!--end--->
<form action="app.php?act=do_edit&id={$info.id}" method="post" enctype="multipart/form-data" data-toggle="ajaxform" id="myform" class="form-horizontal" role="form" data-animation="modal" data-parsley-validate novalidate>
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">×</button>
        <h4 class="modal-title">游戏修改</h4>
    </div>
    <div class="modal-body">
        <div class="form-group">
            <label class="col-md-3 control-label" for="field-1">APP ID</label>
            <div class="col-md-9">
                <input type="text" class="form-control" id="field-1" name="app_id" readonly value="{$info.app_id}" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">APP KEY</label>
            <div class="col-md-9">
                <input type="text" class="form-control" name="app_key" readonly value="{$info.app_key}" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">游戏名称</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" required name="app_name" value="{$info.app_name}" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">游戏类型</label>
            <div class="col-md-9">
                <select name="app_type" class="form-control">
                    <option value="1"{if $info.app_type eq 1} selected{/if}>安卓游戏</option>
                    <option value="2"{if $info.app_type eq 2} selected{/if}>iOS游戏</option>
                    <option value="3"{if $info.app_type eq 3} selected{/if}>小程序</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">角色类型</label>
            <div class="col-md-9">
                <select name="role_type" class="form-control">
                    <option value="0"{if $info.role_type eq 0} selected{/if}>角色名</option>
                    <option value="1"{if $info.role_type eq 1} selected{/if}>角色ID</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">渠道</label>
            <div class="col-md-9">
                <select class="form-control select2" name="ch_id">
                    <option value="">请选择渠道</option>
                    {foreach from=$channel item=ch}
                    <option value="{$ch.id}"{if $ch.id eq $info.ch_id} selected{/if}>{$ch.name}</option>
                    {/foreach}
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">接入状态</label>
            <div class="col-md-9">
                <select class="form-control select2" name="access_type">
                    <option value="0" {if $info.access_type eq '0'} selected{/if}>接入中</option>
                    <option value="1" {if $info.access_type eq '1'} selected{/if}>对接完成</option>
                    <option value="2" {if $info.access_type eq '2'} selected{/if}>终止合作</option>
                    <option value="3" {if $info.access_type eq '3'} selected{/if}>预接入</option>
                    <option value="4" {if $info.access_type eq '4'} selected{/if}>开启运营</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">收款方</label>
            <div class="col-md-9">
                <select class="form-control select2" name="payee_ch">
                    <option value="1" {if $info.payee_ch eq '1'} selected{/if}>福建牛牛</option>
                    <option value="2" {if $info.payee_ch eq '2'} selected{/if}>海南牛牛</option>
                    <option value="3" {if $info.payee_ch eq '3'} selected{/if}>北京智迈</option>
                    <option value="4" {if $info.payee_ch eq '4'} selected{/if}>海南盈趣</option>
                    <option value="5" {if $info.payee_ch eq '5'} selected{/if}>海南奥米茄</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">登记证书图</label>
            <div class="col-md-9">
                <input name="register_img" type="file" class="filestyle" data-buttonname="btn-white">
                {if $info.register_img}
                <div style="margin: 10px 0 0 0"><img src="http://static.66173.cn/{$info.register_img}" alt="image" class="img-responsive thumb-lg"></div>
                {/if}
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">登记号</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="register_num" value="{$info.register_num}" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">备注</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="channel" value="{$info.channel}" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">ICON</label>
            <div class="col-md-9">
                <input name="app_icon" type="file" class="filestyle" data-buttonname="btn-white">
                {if $info.app_icon}
                <div style="margin: 10px 0 0 0"><img src="http://static.66173.cn/{$info.app_icon}" alt="image" class="img-responsive thumb-lg"></div>
                {/if}
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">官网地址</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="web_url" value="{$info.web_url}"/>
                <br>切支付记得使用web.php
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">订单接口</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="sdk_order_url" value="{$info.sdk_order_url}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">回调接口</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="sdk_charge_url" value="{$info.sdk_charge_url}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">web区服接口</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="web_serv_url" value="{$info.web_serv_url}" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">web角色接口</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="web_user_url" value="{$info.web_user_url}" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">web订单号接口</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="web_order_url" value="{$info.web_order_url}" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">web回调接口</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="web_charge_url" value="{$info.web_charge_url}" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">打包地址[安卓]</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="apk_url" value="{$info.apk_url}"/>
            </div>
        </div>
        <!--<div class="form-group">-->
            <!--<label class="col-md-3 control-label">分包状态</label>-->
            <!--<div class="col-md-9">-->
                <!--<select class="form-control" name="ch_status">-->
                    <!--<option value="1">新增公会打包</option>-->
                    <!--<option value="2">强制所有公会重新打包</option>-->
                <!--</select>-->
                <!--<button type="button" onclick="pack_app()" style="float: right;margin-top: 10px" class="btn btn-info waves-effect waves-light">立即打包</button>-->
            <!--</div>-->
        <!--</div>-->
        <div class="form-group">
            <label class="col-md-3 control-label">状态</label>
            <div class="col-md-9 m-t-7">
                运营 <input type="radio" value="1" name="status" {if $info.status eq 1} checked{/if}>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                下线 <input type="radio" value="2" name="status" {if $info.status eq 2} checked{/if}>
            </div>
        </div>
        <div class="form-group" id="offline_time" {if $info.status eq 1}style="display:none"{/if}>
            <label class="col-md-3 control-label">下线时间</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="offline_time" value="{if $info.offline_time}{'Y-m-d H:i:s'|date:$info.offline_time}{/if}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">版本号</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="version" value="{$info.version}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">版本生效时间</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="version_time" value="{'Y-m-d H:i:s'|date:$info.version_time}" readonly/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">关联WEB充值游戏</label>
            <div class="col-md-9">
                <select class="form-control relation_select2" name="relation_id">
                    <option value="">请选择关联游戏</option>
                    {foreach from=$app_list item=data}
                    <option value="{$data.app_id}"{if $data.app_id eq $info.relation_id} selected{/if}>[{$data.app_id}]{$data.app_name}</option>
                    {/foreach}
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">积分兑换比例</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="nnb_scale" value="{$info.nnb_scale}" placeholder="例如，牛币:积分 = 1:100,则输入100"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">更新地址</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="version_url" value="{$info.version_url}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">微信AppId</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="wx_app_id" value="{$info.wx_app_id}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">微信AppSecret</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="wx_app_secret" value="{$info.wx_app_secret}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-3 control-label">微信MCH ID</label>
            <div class="col-md-9">
                <input type="text" class="form-control" parsley-trigger="change" name="mch_id" value="{$info.mch_id}"/>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <input type="hidden" name="id" value="{$info.id}" />
        <input type="hidden" name="old_img" value="{$info.app_icon}" />
        <input type="hidden" name="old_register_img" value="{$info.register_img}" />
        <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">关闭</button>
        <button type="submit" class="btn btn-info waves-effect waves-light">保存</button>
    </div>
</form>
<script>
    jQuery(document).ready(function() {
        $(".relation_select2").select2();
    });
    $('input:radio[name="status"]').change( function(){
        var status=$('input:radio[name="status"]:checked').val();
        if(status == 2){
            $("#offline_time").show();
        }else{
            $("#offline_time").hide();
        }
    });

    function pack_app() {
        var app_id = $("input[name=app_id]").val();
        var apk_url = $("input[name=apk_url]").val();
        var ch_status = $("select[name=ch_status]").val();
        url = "app.php?act=to_apk_pack";
        $.ajax( {
            url: url,
            data:{
                app_id:app_id,
                apk_url:apk_url,
                ch_status:ch_status
            },
            type:'post',
            cache:false,
            dataType:'json',
            timeout : 5000,
            beforeSend:function () {
            },
            success:function(data) {
                if(data.error=='1'){
                    $.Notification.notify('error','top left',data.msg);
                }
            },
            error: function(req, status, error) {
                if(status=='timeout'){
                    $.Notification.autoHideNotify('success','top left', "正在自动打包", "请稍等30分钟后来查看打包情况......");
                }else{
                    $.Notification.notify('error','top left', "发生错误,HTTP代码:"+req.status, req.statusText);
                }
            }
        });
        return false;
    }
</script>
