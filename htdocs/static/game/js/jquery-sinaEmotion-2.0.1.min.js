/*!
 * jQuery Sina Emotion v2.0.1
 * http://www.clanfei.com/
 *
 * Copyright 2012-2014 Lanfei
 * Released under the MIT license
 *
 * Date: 2014-01-09T00:24:18+0800
 */
(function(g){var a;var h;var i;var c;var d="默认";var j=function(){g("body").bind({click:function(){g("#sinaEmotion").hide()}});g("#sinaEmotion").bind({click:function(m){m.stopPropagation()}}).delegate(".prev",{click:function(m){var n=g("#sinaEmotion .categories").data("page");e(n-1);m.preventDefault()}}).delegate(".next",{click:function(m){var n=g("#sinaEmotion .categories").data("page");e(n+1);m.preventDefault()}}).delegate(".category",{click:function(m){g("#sinaEmotion .categories .current").removeClass("current");f(g.trim(g(this).addClass("current").text()));m.preventDefault()}}).delegate(".page",{click:function(m){g("#sinaEmotion .pages .current").removeClass("current");var n=parseInt(g(this).addClass("current").text()-1);b(n);m.preventDefault()}}).delegate(".face",{click:function(n){var m=g("#sinaEmotion").hide().data("target");m.insertText(g(this).children("img").prop("alt"));n.preventDefault()}})};var l=function(m){if(h){m&&m();return}h={};i=[];c={};g("body").append('<div id="sinaEmotion">正在加载，请稍后...</div>');j();g.getJSON("https://api.weibo.com/2/emotions.json?callback=?",{source:a.appKey,language:a.language},function(p){var r,q;var s=p.data;g("#sinaEmotion").html('<div class="right"><a href="#" class="prev">&laquo;</a><a href="#" class="next">&raquo;</a></div><ul class="categories"></ul><ul class="faces"></ul><ul class="pages"></ul>');for(var o=0,n=s.length;o<n;++o){r=s[o];q=r.category||d;if(!h[q]){h[q]=[];i.push(q)}h[q].push({icon:r.icon,phrase:r.phrase});c[r.phrase]=r.icon}m&&m()})};var e=function(s){var p="";var r=i.length;var n=Math.ceil(r/5);var m=g("#sinaEmotion .categories");var q=m.data("category")||d;s=(s+n)%n;for(var o=s*5;o<r&&o<(s+1)*5;++o){p+='<li class="item"><a href="#" class="category'+(q==i[o]?" current":"")+'">'+i[o]+"</a></li>"}m.data("page",s).html(p)};var f=function(m){g("#sinaEmotion .categories").data("category",m);b(0);k()};var b=function(t){var u;var s="";var o="";var v=a.rows;var m=g("#sinaEmotion .categories").data("category");var p=h[m];var n=p.length;t=t||0;for(var r=t*v,q=p.length;r<q&&r<(t+1)*v;++r){u=p[r];s+='<li class="item"><a href="#" class="face"><img src="'+u.icon+'" alt="'+u.phrase+'" /></a></li>'}g("#sinaEmotion .faces").html(s)};var k=function(){var p="";var s=a.rows;var r=g("#sinaEmotion .categories").data("category");var m=h[r];var q=m.length;if(q>s){for(var o=0,n=Math.ceil(q/s);o<n;++o){p+='<li class="item"><a href="#" class="page'+(o==0?" current":"")+'">'+(o+1)+"</a></li>"}g("#sinaEmotion .pages").html(p).show()}else{g("#sinaEmotion .pages").hide()}};g.fn.sinaEmotion=function(m){if(!a){a=g.extend({},g.fn.sinaEmotion.defaults,m)}this.each(function(){var o=g(this);var n=g(a.target);if(!n.length){n=o.parents("form").find("textarea:eq(0)")}if(!n.length){n=o.parents("form").find("input[type=text]:eq(0)")}o.click(function(p){var q=o.offset();l(function(){f(d);e(0)});g("#sinaEmotion").css({top:q.top+o.outerHeight()+5,left:q.left}).data("target",n).show();return false})});return this};g.fn.parseEmotion=function(m){var n=this;if(!a){a=g.extend({},g.fn.sinaEmotion.defaults,m)}l(function(){n.each(function(){var p=g(this);var o=p.html();o=o.replace(/<.*?>/g,function(q){q=q.replace("[","&#91;");q=q.replace("]","&#93;");return q}).replace(/\[[^\[\]]*?\]/g,function(q){var r=c[q];if(r){return'<img src="'+r+'" alt="'+q+'" />'}return q});p.html(o)})});return this};g.fn.insertText=function(m){this.each(function(){if(this.tagName!=="INPUT"&&this.tagName!=="TEXTAREA"){return}if(document.selection){this.focus();var o=document.selection.createRange();o.text=m;o.collapse();o.select()}else{if(this.selectionStart!==undefined){var p=this.selectionStart;var n=this.selectionEnd;this.value=this.value.substring(0,p)+m+this.value.substring(n,this.value.length);this.selectionStart=this.selectionEnd=p+m.length}else{this.value+=m}}});return this};g.fn.sinaEmotion.defaults={rows:72,target:null,language:"cnname",appKey:"1362404091"}})(jQuery);